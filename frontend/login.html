<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <title>Spotify Distribu칤do - Login</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <style>
    /* Fundo geral da p치gina: cinza bem claro, quase branco */
    body { 
        background-color: #f4f6f8; 
        color: #333333; /* Texto cinza escuro para bom contraste */
        display: flex; 
        align-items: center; 
        justify-content: center; 
        height: 100vh; 
        font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
    }

    /* O cart칚o central: branco puro com uma sombra suave para destacar */
    .card { 
        background-color: #ffffff; 
        border: none; 
        width: 400px; 
        border-radius: 12px;
        box-shadow: 0 4px 20px rgba(0,0,0,0.08); /* Sombra elegante */
    }

    /* T칤tulo */
    h2 {
        color: #121212;
        font-weight: 700;
    }

    /* Abas de navega칞칚o (Login/Cadastro) */
    .nav-pills .nav-link {
        color: #555; /* Cor do texto da aba inativa */
        font-weight: 500;
    }
    
    .nav-pills .nav-link.active {
        background-color: #1db954; /* Verde Spotify */
        color: white;
    }

    /* Campos de input: Fundo branco com borda suave */
    .form-control { 
        background-color: #f9f9f9; 
        border: 1px solid #e0e0e0; 
        color: #333; 
        padding: 12px;
    }

    /* Ao clicar no input */
    .form-control:focus { 
        background-color: #ffffff; 
        color: #333; 
        border-color: #1db954; /* Borda verde ao digitar */
        box-shadow: 0 0 0 0.2rem rgba(29, 185, 84, 0.25);
    }

    /* Bot칚o Principal */
    .btn-green { 
        background-color: #1db954; 
        color: white; 
        font-weight: bold; 
        border-radius: 50px; 
        padding: 10px;
        font-size: 16px;
        transition: all 0.3s;
    }

    .btn-green:hover { 
        background-color: #1ed760; 
        color: white; 
        transform: scale(1.02); /* Pequeno efeito de zoom */
    }
    
    /* Bot칚o Secund치rio (Criar Conta) - Estilo Outline escuro */
    .btn-outline-dark-custom {
        border: 2px solid #333;
        color: #333;
        font-weight: bold;
        border-radius: 50px;
        padding: 10px;
    }
    
    .btn-outline-dark-custom:hover {
        background-color: #333;
        color: white;
    }
</style>
</head>
<body>

<div class="card p-4">
    <h2 class="text-center mb-4">游꿧 MusicApp</h2>
    
    <ul class="nav nav-pills mb-3 justify-content-center" id="pills-tab">
        <li class="nav-item"><button class="nav-link active btn-sm" onclick="showForm('login')">Login</button></li>
        <li class="nav-item"><button class="nav-link btn-sm" onclick="showForm('register')">Cadastro</button></li>
    </ul>

    <div id="login-form">
        <input type="text" id="loginUser" class="form-control mb-3" placeholder="Usu치rio / Email">
        <input type="password" id="loginPass" class="form-control mb-3" placeholder="Senha">
        <button onclick="doLogin()" class="btn btn-green w-100">Entrar</button>
    </div>

    <div id="register-form" style="display: none;">
        <input type="text" id="regUser" class="form-control mb-3" placeholder="Escolha um Usu치rio">
        <input type="password" id="regPass" class="form-control mb-3" placeholder="Crie uma Senha">
        <button onclick="doRegister()" class="btn btn-outline-dark-custom w-100">Criar Conta</button>
    </div>
    
    <div id="msg" class="text-center mt-3 text-danger"></div>
</div>

<script>
    // URL do seu m칩dulo Auth (Ajuste a porta se precisar)
    const AUTH_API = "http://localhost:8081/auth"; 

    function showForm(type) {
        document.getElementById('login-form').style.display = type === 'login' ? 'block' : 'none';
        document.getElementById('register-form').style.display = type === 'register' ? 'block' : 'none';
    }

    async function doLogin() {
        const user = document.getElementById('loginUser').value;
        const pass = document.getElementById('loginPass').value;

        try {
            // Simulando chamada ao Java
            const response = await fetch(`${AUTH_API}/login`, {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({ username: user, password: pass })
            });

            if (response.ok) {
                const data = await response.json();
                // Salva o token JWT e o ID do usu치rio
                localStorage.setItem('token', data.token);
                localStorage.setItem('userId', data.userId);
                window.location.href = 'index.html'; // Vai para a p치gina principal
            } else {
                document.getElementById('msg').innerText = "Login falhou!";
            }
        } catch (e) {
            console.error(e);
            document.getElementById('msg').innerText = "Erro de conex칚o com o servidor.";
        }
    }

    async function doRegister() {
        const user = document.getElementById('regUser').value;
        const pass = document.getElementById('regPass').value;
        const msgDiv = document.getElementById('msg'); // Elemento para msg de erro/sucesso

        // Limpeza b치sica
        if (!user || !pass) {
            msgDiv.innerText = "Preencha todos os campos!";
            msgDiv.className = "text-center mt-3 text-warning";
            return;
        }

        try {
            const response = await fetch(`${AUTH_API}/register`, {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({ username: user, password: pass, role: "FREE" })
            });

            if (response.ok) {
                // SUCESSO
                msgDiv.innerText = "Conta criada com sucesso! Fa칞a login.";
                msgDiv.className = "text-center mt-3 text-success";
                
                // Opcional: Limpar campos
                document.getElementById('regUser').value = "";
                document.getElementById('regPass').value = "";
                
                // Opcional: Mudar automaticamente para a aba de login ap칩s 2 segundos
                setTimeout(() => showForm('login'), 2000);
                
            } else if (response.status === 409) {
                // CONFLITO (Usu치rio j치 existe)
                msgDiv.innerText = "Erro: Este usu치rio j치 existe.";
                msgDiv.className = "text-center mt-3 text-danger";
            } else {
                // OUTROS ERROS
                msgDiv.innerText = "Erro ao criar conta.";
                msgDiv.className = "text-center mt-3 text-danger";
            }

        } catch (e) {
            console.error(e);
            msgDiv.innerText = "Erro de conex칚o com o servidor.";
            msgDiv.className = "text-center mt-3 text-danger";
        }
    }
</script>
</body>
</html>